(this["webpackJsonpreact-web-rtc"]=this["webpackJsonpreact-web-rtc"]||[]).push([[0],{20:function(e,t,n){},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var a=n(9),c=n(14),r=n.n(c),o=(n(20),n(6)),i=n.n(o),d=n(10),s=n(15),u=(n(22),n.p,n(11)),l=(n(26),n(2));u.a.apps.length||u.a.initializeApp({apiKey:"AIzaSyDpLbGo4YhYPfVE5iY49lDhN88Tx3LUvs8",authDomain:"react-web-rtc.firebaseapp.com",databaseURL:"https://react-web-rtc-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"react-web-rtc",storageBucket:"react-web-rtc.appspot.com",messagingSenderId:"340688411698",appId:"1:340688411698:web:25e56d0a6d38412084702b",measurementId:"G-W5LNPQ6KHN"});var p,f,m=u.a.firestore(),b=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});var h=function(){var e=document.getElementById("webcamButton"),t=document.getElementById("webcamVideo"),n=document.getElementById("callButton"),c=document.getElementById("callInput"),r=document.getElementById("answerButton"),o=document.getElementById("remoteVideo"),u=(document.getElementById("hangupButton"),Object(a.useState)("")),h=Object(s.a)(u,2),j=h[0],w=h[1],g=function(){var a=Object(d.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:p=a.sent,f=new MediaStream,p.getTracks().forEach((function(e){b.addTrack(e,p)})),b.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){f.addTrack(e)}))},t.srcObject=p,o.srcObject=f,n.disabled=!1,r.disabled=!1,e.disabled=!0;case 11:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),x=function(){var e=Object(d.a)(i.a.mark((function e(){var t,n,a,r,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.collection("calls").doc(),n=t.collection("offerCandidates"),a=t.collection("answerCandidates"),r=function(){n=t.collection("offerCandidates"),a=t.collection("answerCandidates"),w(t.id)},b.onicecandidate=function(){var e=Object(d.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:t.candidate&&n.add(t.candidate.toJSON());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.value=j,e.next=8,b.onicecandidate(n);case 8:return e.next=10,b.createOffer();case 10:return o=e.sent,e.next=13,b.setLocalDescription(o);case 13:return s={sdp:o.sdp,type:o.type},e.next=16,t.set({offer:s});case 16:t.onSnapshot((function(e){var t=e.data();if(!b.currentRemoteDescription&&(null===t||void 0===t?void 0:t.answer)){var n=new RTCSessionDescription(t.answer);b.setRemoteDescription(n)}})),a.onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var t=new RTCIceCandidate(e.doc.data());b.addIceCandidate(t)}}))}));case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=Object(d.a)(i.a.mark((function e(){var t,n,a,r,o,d,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.collection("calls").doc(c.value),n=t.collection("answerCandidates"),a=t.collection("offerCandidates"),b.onicecandidate=function(e){e.candidate&&n.add(e.candidate.toJSON())},e.next=6,t.get();case 6:return r=e.sent.data(),o=r.offer,e.next=10,b.setRemoteDescription(new RTCSessionDescription(o));case 10:return e.next=12,b.createAnswer();case 12:return d=e.sent,e.next=15,b.setLocalDescription(d);case 15:return s={type:d.type,sdp:d.sdp},e.next=18,t.update({answer:s});case 18:a.onSnapshot((function(e){e.docChanges().forEach((function(e){if(console.log(e),"added"===e.type){var t=e.doc.data();b.addIceCandidate(new RTCIceCandidate(t))}}))}));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){e=document.getElementById("webcamButton"),t=document.getElementById("webcamVideo"),n=document.getElementById("callButton"),c=document.getElementById("callInput"),r=document.getElementById("answerButton"),o=document.getElementById("remoteVideo"),document.getElementById("hangupButton")})),Object(l.jsxs)("div",{className:"App",children:[Object(l.jsx)("h2",{children:"1. Start your Webcam"}),Object(l.jsxs)("div",{className:"videos",children:[Object(l.jsxs)("span",{children:[Object(l.jsx)("h3",{children:"Local Stream"}),Object(l.jsx)("video",{id:"webcamVideo",autoPlay:!0,playsInline:!0})]}),Object(l.jsxs)("span",{children:[Object(l.jsx)("h3",{children:"Remote Stream"}),Object(l.jsx)("video",{id:"remoteVideo",autoPlay:!0,playsInline:!0})]})]}),Object(l.jsx)("button",{id:"webcamButton",onClick:g,children:"Start webcam"}),Object(l.jsx)("h2",{children:"2. Create a new Call"}),Object(l.jsx)("button",{id:"callButton",onClick:x,children:"Create Call (offer)"}),Object(l.jsx)("h2",{children:"3. Join a Call"}),Object(l.jsx)("p",{children:"Answer the call from a different browser window or device"}),Object(l.jsx)("input",{id:"callInput"}),Object(l.jsx)("button",{id:"answerButton",onClick:v,children:"Answer"}),Object(l.jsx)("h2",{children:"4. Hangup"}),Object(l.jsx)("button",{id:"hangupButton",children:"Hangup"})]})},j=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,27)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};r.a.render(Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(h,{})}),document.getElementById("root")),j()}},[[25,1,2]]]);
//# sourceMappingURL=main.aa993bfc.chunk.js.map